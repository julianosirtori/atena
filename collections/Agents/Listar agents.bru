meta {
  name: Listar agents
  type: http
  seq: 1
}

get {
  url: {{baseUrl}}/api/v1/tenants/{{tenantId}}/agents
  body: none
  auth: none
}

script:post-response {
  const body = res.getBody();
  if (body && body.data && body.data.length > 0) {
    bru.setEnvVar("agentId", body.data[0].id);
  }
}

tests {
  test("status code é 200", function() {
    expect(res.getStatus()).to.equal(200);
  });

  test("data é um array", function() {
    const body = res.getBody();
    expect(body.data).to.be.an("array");
  });

  test("agent tem id, name e email", function() {
    const body = res.getBody();
    if (body.data.length > 0) {
      const agent = body.data[0];
      expect(agent.id).to.be.a("string");
      expect(agent.name).to.be.a("string");
      expect(agent.email).to.be.a("string");
    }
  });
}

docs {
  # Listar agents

  Retorna todos os agentes do tenant.

  **Dica:** O script pós-resposta preenche automaticamente a variável `agentId` com o primeiro agente retornado.

  ## Path params

  | Param | Tipo | Descrição |
  |-------|------|-----------|
  | `tenantId` | UUID | ID do tenant |

  ## Resposta (200)

  ```json
  {
    "data": [
      {
        "id": "uuid",
        "name": "Carlos Silva",
        "email": "carlos@lojademo.com.br",
        "role": "admin",
        "isActive": true,
        "isOnline": true,
        "maxConcurrent": 10,
        "activeConversations": 2,
        "telegramChatId": "123456789",
        "notificationPreferences": {
          "telegram": true,
          "web_push": true,
          "sound": true
        },
        "createdAt": "2026-02-01T00:00:00.000Z"
      }
    ]
  }
  ```

  ## Campos da resposta

  | Campo | Tipo | Descrição |
  |-------|------|-----------|
  | `id` | UUID | ID do agente |
  | `name` | string | Nome do agente |
  | `email` | string | E-mail (único por tenant) |
  | `role` | enum | `admin` ou `agent` |
  | `isActive` | boolean | Se está ativo no sistema |
  | `isOnline` | boolean | Se está online agora |
  | `maxConcurrent` | integer | Máximo de conversas simultâneas |
  | `activeConversations` | integer | Conversas ativas no momento |
  | `telegramChatId` | string \| null | Chat ID para notificações Telegram |
  | `notificationPreferences` | object | Preferências de notificação |
  | `createdAt` | timestamp | Data de criação |
}
